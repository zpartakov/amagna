(function(b){b.fn.glossary=function(a,c){var c=b.extend({ignorecase:!1,tiptag:"h6",excludetags:[],linktarget:"_blank"},c),g=1;return this.each(function(k,m){b.each(c.excludetags,function(e,f){c.excludetags[e]=f.toUpperCase()});var l=function(e,f,a,j){var h=f,d=0;if(3==e.nodeType){var i=c.ignorecase?e.data.toLowerCase().indexOf(h.toLowerCase()):e.data.indexOf(h);0<=i&&(-1<jQuery.inArray(b(e).parent().get(0).tagName,c.excludetags)||(d=document.createElement("a"),d.className="glossaryTerm","0"==a?(d.id=
"glossaryID"+g,d.href="#",d.title="Click for '"+f+"' definition",d.className="glossaryTerm",b(d).click(function(a){b.glossaryTip("<"+c.tiptag+">"+f+"</"+c.tiptag+"><p>"+j+"</p>",{mouse_event:a});return!1})):"1"==a?(d.title="Click to look up '"+f+"' in Wikipedia",f=f.replace(/ /g,"_"),d.href="http://en.wikipedia.org/wiki/"+f,d.target=c.linktarget):"2"==a?(d.title="Click to search for '"+f+"' in Google",f=f.replace(/ /g,"+"),d.href="http://www.google.co.uk/search?q="+f,d.target=c.linktarget):"3"==a&&
(d.title="Click to view '"+f+"' definition",d.href=j,d.target=c.linktarget),e=e.splitText(i),e.splitText(h.length),a=e.cloneNode(!0),d.appendChild(a),e.parentNode.replaceChild(d,e)),d=1,g+=1)}else if(1==e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(h=0;h<e.childNodes.length;++h)h+=l(e.childNodes[h],f,j,a);return d};b.ajax({type:"GET",url:a,dataType:"json",success:function(a){if(a)for(var f=a.length,b=0;b<f;b++){var c=a[b];l(m,c.term,c.type,c.definition)}},error:function(){}})})};
var a=function(){};b.extend(a.prototype,{setup:function(){b("#glossaryTip").length&&b("#glossaryTip").remove();a.holder=b('<div id="glossaryTip" style="max-width:260px;"><div id="glossaryClose"></div></div>');a.content=b('<div id="glossaryContent"></div>');b("body").append(a.holder.append(a.content))},show:function(b,c){a.content.html(b);var g=parseInt(c.mouse_event.pageX)+15,k=parseInt(c.mouse_event.pageY)+5;a.holder.css({top:k,left:g});a.holder.is(":hidden")&&a.holder.show();a.holder.bind("click",
function(){a.holder.stop(!0).fadeOut(200);return!1})}});b.glossaryTip=function(i,c){var g=b.glossaryTip.instance;g||(g=b.glossaryTip.instance=new a);g.setup();g.show(i,c);return g}})(jQuery);